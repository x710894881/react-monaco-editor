{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as Parser from '../parser/jsonParser.js';\nimport * as Strings from '../utils/strings.js';\nimport { colorFromHex } from '../utils/colors.js';\nimport { SymbolKind, Range, Location, TextEdit } from '../_deps/vscode-languageserver-types/main.js';\n\nvar JSONDocumentSymbols =\n/** @class */\nfunction () {\n  function JSONDocumentSymbols(schemaService) {\n    this.schemaService = schemaService;\n  }\n\n  JSONDocumentSymbols.prototype.findDocumentSymbols = function (document, doc) {\n    var _this = this;\n\n    var root = doc.root;\n\n    if (!root) {\n      return null;\n    } // special handling for key bindings\n\n\n    var resourceString = document.uri;\n\n    if (resourceString === 'vscode://defaultsettings/keybindings.json' || Strings.endsWith(resourceString.toLowerCase(), '/user/keybindings.json')) {\n      if (root.type === 'array') {\n        var result_1 = [];\n        root.items.forEach(function (item) {\n          if (item.type === 'object') {\n            for (var _i = 0, _a = item.properties; _i < _a.length; _i++) {\n              var property = _a[_i];\n\n              if (property.keyNode.value === 'key') {\n                if (property.valueNode) {\n                  if (property.valueNode) {\n                    var location = Location.create(document.uri, getRange(document, item));\n                    result_1.push({\n                      name: Parser.getNodeValue(property.valueNode),\n                      kind: SymbolKind.Function,\n                      location: location\n                    });\n                  }\n\n                  return;\n                }\n              }\n            }\n          }\n        });\n        return result_1;\n      }\n    }\n\n    var collectOutlineEntries = function (result, node, containerName) {\n      if (node.type === 'array') {\n        node.items.forEach(function (node) {\n          return collectOutlineEntries(result, node, containerName);\n        });\n      } else if (node.type === 'object') {\n        node.properties.forEach(function (property) {\n          var location = Location.create(document.uri, getRange(document, property));\n          var valueNode = property.valueNode;\n\n          if (valueNode) {\n            var childContainerName = containerName ? containerName + '.' + property.keyNode.value : property.keyNode.value;\n            result.push({\n              name: _this.getKeyLabel(property),\n              kind: _this.getSymbolKind(valueNode.type),\n              location: location,\n              containerName: containerName\n            });\n            collectOutlineEntries(result, valueNode, childContainerName);\n          }\n        });\n      }\n\n      return result;\n    };\n\n    var result = collectOutlineEntries([], root, void 0);\n    return result;\n  };\n\n  JSONDocumentSymbols.prototype.findDocumentSymbols2 = function (document, doc) {\n    var _this = this;\n\n    var root = doc.root;\n\n    if (!root) {\n      return null;\n    } // special handling for key bindings\n\n\n    var resourceString = document.uri;\n\n    if (resourceString === 'vscode://defaultsettings/keybindings.json' || Strings.endsWith(resourceString.toLowerCase(), '/user/keybindings.json')) {\n      if (root.type === 'array') {\n        var result_2 = [];\n        root.items.forEach(function (item) {\n          if (item.type === 'object') {\n            for (var _i = 0, _a = item.properties; _i < _a.length; _i++) {\n              var property = _a[_i];\n\n              if (property.keyNode.value === 'key') {\n                if (property.valueNode) {\n                  var range = getRange(document, item);\n                  var selectionRange = getRange(document, property.keyNode);\n                  result_2.push({\n                    name: Parser.getNodeValue(property.valueNode),\n                    kind: SymbolKind.Function,\n                    range: range,\n                    selectionRange: selectionRange\n                  });\n                }\n\n                return;\n              }\n            }\n          }\n        });\n        return result_2;\n      }\n    }\n\n    var collectOutlineEntries = function (result, node) {\n      if (node.type === 'array') {\n        node.items.forEach(function (node, index) {\n          if (node) {\n            var range = getRange(document, node);\n            var selectionRange = range;\n            var name = String(index);\n            var children = collectOutlineEntries([], node);\n            result.push({\n              name: name,\n              kind: _this.getSymbolKind(node.type),\n              range: range,\n              selectionRange: selectionRange,\n              children: children\n            });\n          }\n        });\n      } else if (node.type === 'object') {\n        node.properties.forEach(function (property) {\n          var valueNode = property.valueNode;\n\n          if (valueNode) {\n            var range = getRange(document, property);\n            var selectionRange = getRange(document, property.keyNode);\n            var children = collectOutlineEntries([], valueNode);\n            result.push({\n              name: _this.getKeyLabel(property),\n              kind: _this.getSymbolKind(valueNode.type),\n              range: range,\n              selectionRange: selectionRange,\n              children: children\n            });\n          }\n        });\n      }\n\n      return result;\n    };\n\n    var result = collectOutlineEntries([], root);\n    return result;\n  };\n\n  JSONDocumentSymbols.prototype.getSymbolKind = function (nodeType) {\n    switch (nodeType) {\n      case 'object':\n        return SymbolKind.Module;\n\n      case 'string':\n        return SymbolKind.String;\n\n      case 'number':\n        return SymbolKind.Number;\n\n      case 'array':\n        return SymbolKind.Array;\n\n      case 'boolean':\n        return SymbolKind.Boolean;\n\n      default:\n        // 'null'\n        return SymbolKind.Variable;\n    }\n  };\n\n  JSONDocumentSymbols.prototype.getKeyLabel = function (property) {\n    var name = property.keyNode.value;\n\n    if (name) {\n      name = name.replace(/[\\n]/g, 'â†µ');\n    }\n\n    if (name && name.trim()) {\n      return name;\n    }\n\n    return \"\\\"\" + name + \"\\\"\";\n  };\n\n  JSONDocumentSymbols.prototype.findDocumentColors = function (document, doc) {\n    return this.schemaService.getSchemaForResource(document.uri, doc).then(function (schema) {\n      var result = [];\n\n      if (schema) {\n        var matchingSchemas = doc.getMatchingSchemas(schema.schema);\n        var visitedNode = {};\n\n        for (var _i = 0, matchingSchemas_1 = matchingSchemas; _i < matchingSchemas_1.length; _i++) {\n          var s = matchingSchemas_1[_i];\n\n          if (!s.inverted && s.schema && (s.schema.format === 'color' || s.schema.format === 'color-hex') && s.node && s.node.type === 'string') {\n            var nodeId = String(s.node.offset);\n\n            if (!visitedNode[nodeId]) {\n              var color = colorFromHex(Parser.getNodeValue(s.node));\n\n              if (color) {\n                var range = getRange(document, s.node);\n                result.push({\n                  color: color,\n                  range: range\n                });\n              }\n\n              visitedNode[nodeId] = true;\n            }\n          }\n        }\n      }\n\n      return result;\n    });\n  };\n\n  JSONDocumentSymbols.prototype.getColorPresentations = function (document, doc, color, range) {\n    var result = [];\n    var red256 = Math.round(color.red * 255),\n        green256 = Math.round(color.green * 255),\n        blue256 = Math.round(color.blue * 255);\n\n    function toTwoDigitHex(n) {\n      var r = n.toString(16);\n      return r.length !== 2 ? '0' + r : r;\n    }\n\n    var label;\n\n    if (color.alpha === 1) {\n      label = \"#\" + toTwoDigitHex(red256) + toTwoDigitHex(green256) + toTwoDigitHex(blue256);\n    } else {\n      label = \"#\" + toTwoDigitHex(red256) + toTwoDigitHex(green256) + toTwoDigitHex(blue256) + toTwoDigitHex(Math.round(color.alpha * 255));\n    }\n\n    result.push({\n      label: label,\n      textEdit: TextEdit.replace(range, JSON.stringify(label))\n    });\n    return result;\n  };\n\n  return JSONDocumentSymbols;\n}();\n\nexport { JSONDocumentSymbols };\n\nfunction getRange(document, node) {\n  return Range.create(document.positionAt(node.offset), document.positionAt(node.offset + node.length));\n}","map":null,"metadata":{},"sourceType":"module"}