{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as jsonService from './_deps/vscode-json-languageservice/jsonLanguageService.js';\nimport * as ls from './_deps/vscode-languageserver-types/main.js';\nvar defaultSchemaRequestService;\n\nif (typeof fetch !== 'undefined') {\n  defaultSchemaRequestService = function (url) {\n    return fetch(url).then(function (response) {\n      return response.text();\n    });\n  };\n}\n\nvar PromiseAdapter =\n/** @class */\nfunction () {\n  function PromiseAdapter(executor) {\n    this.wrapped = new Promise(executor);\n  }\n\n  PromiseAdapter.prototype.then = function (onfulfilled, onrejected) {\n    var thenable = this.wrapped;\n    return thenable.then(onfulfilled, onrejected);\n  };\n\n  PromiseAdapter.prototype.getWrapped = function () {\n    return this.wrapped;\n  };\n\n  PromiseAdapter.resolve = function (v) {\n    return Promise.resolve(v);\n  };\n\n  PromiseAdapter.reject = function (v) {\n    return Promise.reject(v);\n  };\n\n  PromiseAdapter.all = function (values) {\n    return Promise.all(values);\n  };\n\n  return PromiseAdapter;\n}();\n\nvar JSONWorker =\n/** @class */\nfunction () {\n  function JSONWorker(ctx, createData) {\n    this._ctx = ctx;\n    this._languageSettings = createData.languageSettings;\n    this._languageId = createData.languageId;\n    this._languageService = jsonService.getLanguageService({\n      schemaRequestService: createData.enableSchemaRequest && defaultSchemaRequestService,\n      promiseConstructor: PromiseAdapter\n    });\n\n    this._languageService.configure(this._languageSettings);\n  }\n\n  JSONWorker.prototype.doValidation = function (uri) {\n    var document = this._getTextDocument(uri);\n\n    if (document) {\n      var jsonDocument = this._languageService.parseJSONDocument(document);\n\n      return this._languageService.doValidation(document, jsonDocument);\n    }\n\n    return Promise.resolve([]);\n  };\n\n  JSONWorker.prototype.doComplete = function (uri, position) {\n    var document = this._getTextDocument(uri);\n\n    var jsonDocument = this._languageService.parseJSONDocument(document);\n\n    return this._languageService.doComplete(document, position, jsonDocument);\n  };\n\n  JSONWorker.prototype.doResolve = function (item) {\n    return this._languageService.doResolve(item);\n  };\n\n  JSONWorker.prototype.doHover = function (uri, position) {\n    var document = this._getTextDocument(uri);\n\n    var jsonDocument = this._languageService.parseJSONDocument(document);\n\n    return this._languageService.doHover(document, position, jsonDocument);\n  };\n\n  JSONWorker.prototype.format = function (uri, range, options) {\n    var document = this._getTextDocument(uri);\n\n    var textEdits = this._languageService.format(document, range, options);\n\n    return Promise.resolve(textEdits);\n  };\n\n  JSONWorker.prototype.resetSchema = function (uri) {\n    return Promise.resolve(this._languageService.resetSchema(uri));\n  };\n\n  JSONWorker.prototype.findDocumentSymbols = function (uri) {\n    var document = this._getTextDocument(uri);\n\n    var jsonDocument = this._languageService.parseJSONDocument(document);\n\n    var symbols = this._languageService.findDocumentSymbols(document, jsonDocument);\n\n    return Promise.resolve(symbols);\n  };\n\n  JSONWorker.prototype.findDocumentColors = function (uri) {\n    var document = this._getTextDocument(uri);\n\n    var stylesheet = this._languageService.parseJSONDocument(document);\n\n    var colorSymbols = this._languageService.findDocumentColors(document, stylesheet);\n\n    return Promise.resolve(colorSymbols);\n  };\n\n  JSONWorker.prototype.getColorPresentations = function (uri, color, range) {\n    var document = this._getTextDocument(uri);\n\n    var stylesheet = this._languageService.parseJSONDocument(document);\n\n    var colorPresentations = this._languageService.getColorPresentations(document, stylesheet, color, range);\n\n    return Promise.resolve(colorPresentations);\n  };\n\n  JSONWorker.prototype.provideFoldingRanges = function (uri, context) {\n    var document = this._getTextDocument(uri);\n\n    var ranges = this._languageService.getFoldingRanges(document, context);\n\n    return Promise.resolve(ranges);\n  };\n\n  JSONWorker.prototype._getTextDocument = function (uri) {\n    var models = this._ctx.getMirrorModels();\n\n    for (var _i = 0, models_1 = models; _i < models_1.length; _i++) {\n      var model = models_1[_i];\n\n      if (model.uri.toString() === uri) {\n        return ls.TextDocument.create(uri, this._languageId, model.version, model.getValue());\n      }\n    }\n\n    return null;\n  };\n\n  return JSONWorker;\n}();\n\nexport { JSONWorker };\nexport function create(ctx, createData) {\n  return new JSONWorker(ctx, createData);\n}","map":null,"metadata":{},"sourceType":"module"}