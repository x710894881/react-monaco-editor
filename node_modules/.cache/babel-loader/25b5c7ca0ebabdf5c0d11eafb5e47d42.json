{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n'use strict';\n\nimport * as nodes from '../parser/cssNodes.js';\nimport * as languageFacts from '../languageFacts/facts.js';\nimport { difference } from '../utils/strings.js';\nimport { Rules } from '../services/lintRules.js';\nimport { Command, TextEdit, CodeAction, CodeActionKind, TextDocumentEdit, VersionedTextDocumentIdentifier } from '../../vscode-languageserver-types/main.js';\nimport * as nls from '../../../fillers/vscode-nls.js';\nvar localize = nls.loadMessageBundle();\n\nvar CSSCodeActions =\n/** @class */\nfunction () {\n  function CSSCodeActions() {}\n\n  CSSCodeActions.prototype.doCodeActions = function (document, range, context, stylesheet) {\n    return this.doCodeActions2(document, range, context, stylesheet).map(function (ca) {\n      return Command.create(ca.title, '_css.applyCodeAction', document.uri, document.version, ca.edit.documentChanges[0].edits);\n    });\n  };\n\n  CSSCodeActions.prototype.doCodeActions2 = function (document, range, context, stylesheet) {\n    var result = [];\n\n    if (context.diagnostics) {\n      for (var _i = 0, _a = context.diagnostics; _i < _a.length; _i++) {\n        var diagnostic = _a[_i];\n        this.appendFixesForMarker(document, stylesheet, diagnostic, result);\n      }\n    }\n\n    return result;\n  };\n\n  CSSCodeActions.prototype.getFixesForUnknownProperty = function (document, property, marker, result) {\n    var propertyName = property.getName();\n    var candidates = [];\n    languageFacts.cssDataManager.getProperties().forEach(function (p) {\n      var score = difference(propertyName, p.name);\n\n      if (score >= propertyName.length / 2\n      /*score_lim*/\n      ) {\n          candidates.push({\n            property: p.name,\n            score: score\n          });\n        }\n    }); // Sort in descending order.\n\n    candidates.sort(function (a, b) {\n      return b.score - a.score;\n    });\n    var maxActions = 3;\n\n    for (var _i = 0, candidates_1 = candidates; _i < candidates_1.length; _i++) {\n      var candidate = candidates_1[_i];\n      var propertyName_1 = candidate.property;\n      var title = localize('css.codeaction.rename', \"Rename to '{0}'\", propertyName_1);\n      var edit = TextEdit.replace(marker.range, propertyName_1);\n      var documentIdentifier = VersionedTextDocumentIdentifier.create(document.uri, document.version);\n      var workspaceEdit = {\n        documentChanges: [TextDocumentEdit.create(documentIdentifier, [edit])]\n      };\n      var codeAction = CodeAction.create(title, workspaceEdit, CodeActionKind.QuickFix);\n      codeAction.diagnostics = [marker];\n      result.push(codeAction);\n\n      if (--maxActions <= 0) {\n        return;\n      }\n    }\n  };\n\n  CSSCodeActions.prototype.appendFixesForMarker = function (document, stylesheet, marker, result) {\n    if (marker.code !== Rules.UnknownProperty.id) {\n      return;\n    }\n\n    var offset = document.offsetAt(marker.range.start);\n    var end = document.offsetAt(marker.range.end);\n    var nodepath = nodes.getNodePath(stylesheet, offset);\n\n    for (var i = nodepath.length - 1; i >= 0; i--) {\n      var node = nodepath[i];\n\n      if (node instanceof nodes.Declaration) {\n        var property = node.getProperty();\n\n        if (property && property.offset === offset && property.end === end) {\n          this.getFixesForUnknownProperty(document, property, marker, result);\n          return;\n        }\n      }\n    }\n  };\n\n  return CSSCodeActions;\n}();\n\nexport { CSSCodeActions };","map":null,"metadata":{},"sourceType":"module"}