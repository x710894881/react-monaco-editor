{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { TextDocument, Position, CompletionItem, CompletionList, Hover, Range, SymbolInformation, Diagnostic, TextEdit, FormattingOptions, MarkedString } from './_deps/vscode-languageserver-types/main.js';\nimport { JSONCompletion } from './services/jsonCompletion.js';\nimport { JSONHover } from './services/jsonHover.js';\nimport { JSONValidation } from './services/jsonValidation.js';\nimport { JSONDocumentSymbols } from './services/jsonDocumentSymbols.js';\nimport { parse as parseJSON, newJSONDocument } from './parser/jsonParser.js';\nimport { schemaContributions } from './services/configuration.js';\nimport { JSONSchemaService } from './services/jsonSchemaService.js';\nimport { getFoldingRanges } from './services/jsonFolding.js';\nimport { getSelectionRanges } from './services/jsonSelectionRanges.js';\nimport { format as formatJSON } from '../jsonc-parser/main.js';\nexport * from './jsonLanguageTypes.js';\nexport { TextDocument, Position, CompletionItem, CompletionList, Hover, Range, SymbolInformation, Diagnostic, TextEdit, FormattingOptions, MarkedString };\nexport function getLanguageService(params) {\n  var promise = params.promiseConstructor || Promise;\n  var jsonSchemaService = new JSONSchemaService(params.schemaRequestService, params.workspaceContext, promise);\n  jsonSchemaService.setSchemaContributions(schemaContributions);\n  var jsonCompletion = new JSONCompletion(jsonSchemaService, params.contributions, promise, params.clientCapabilities);\n  var jsonHover = new JSONHover(jsonSchemaService, params.contributions, promise);\n  var jsonDocumentSymbols = new JSONDocumentSymbols(jsonSchemaService);\n  var jsonValidation = new JSONValidation(jsonSchemaService, promise);\n  return {\n    configure: function (settings) {\n      jsonSchemaService.clearExternalSchemas();\n\n      if (settings.schemas) {\n        settings.schemas.forEach(function (settings) {\n          jsonSchemaService.registerExternalSchema(settings.uri, settings.fileMatch, settings.schema);\n        });\n      }\n\n      jsonValidation.configure(settings);\n    },\n    resetSchema: function (uri) {\n      return jsonSchemaService.onResourceChange(uri);\n    },\n    doValidation: jsonValidation.doValidation.bind(jsonValidation),\n    parseJSONDocument: function (document) {\n      return parseJSON(document, {\n        collectComments: true\n      });\n    },\n    newJSONDocument: function (root, diagnostics) {\n      return newJSONDocument(root, diagnostics);\n    },\n    doResolve: jsonCompletion.doResolve.bind(jsonCompletion),\n    doComplete: jsonCompletion.doComplete.bind(jsonCompletion),\n    findDocumentSymbols: jsonDocumentSymbols.findDocumentSymbols.bind(jsonDocumentSymbols),\n    findDocumentSymbols2: jsonDocumentSymbols.findDocumentSymbols2.bind(jsonDocumentSymbols),\n    findColorSymbols: function (d, s) {\n      return jsonDocumentSymbols.findDocumentColors(d, s).then(function (s) {\n        return s.map(function (s) {\n          return s.range;\n        });\n      });\n    },\n    findDocumentColors: jsonDocumentSymbols.findDocumentColors.bind(jsonDocumentSymbols),\n    getColorPresentations: jsonDocumentSymbols.getColorPresentations.bind(jsonDocumentSymbols),\n    doHover: jsonHover.doHover.bind(jsonHover),\n    getFoldingRanges: getFoldingRanges,\n    getSelectionRanges: getSelectionRanges,\n    format: function (d, r, o) {\n      var range = void 0;\n\n      if (r) {\n        var offset = d.offsetAt(r.start);\n        var length = d.offsetAt(r.end) - offset;\n        range = {\n          offset: offset,\n          length: length\n        };\n      }\n\n      var options = {\n        tabSize: o ? o.tabSize : 4,\n        insertSpaces: o ? o.insertSpaces : true,\n        eol: '\\n'\n      };\n      return formatJSON(d.getText(), range, options).map(function (e) {\n        return TextEdit.replace(Range.create(d.positionAt(e.offset), d.positionAt(e.offset + e.length)), e.content);\n      });\n    }\n  };\n}","map":null,"metadata":{},"sourceType":"module"}