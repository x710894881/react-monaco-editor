{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport { ReferencesModel, FileReferences, OneReference } from './referencesModel.js';\nimport { ITextModelService } from '../../common/services/resolverService.js';\nimport { IconLabel } from '../../../base/browser/ui/iconLabel/iconLabel.js';\nimport { CountBadge } from '../../../base/browser/ui/countBadge/countBadge.js';\nimport { ILabelService } from '../../../platform/label/common/label.js';\nimport { IThemeService } from '../../../platform/theme/common/themeService.js';\nimport { attachBadgeStyler } from '../../../platform/theme/common/styler.js';\nimport * as dom from '../../../base/browser/dom.js';\nimport { localize } from '../../../nls.js';\nimport { getBaseLabel } from '../../../base/common/labels.js';\nimport { dirname, basename } from '../../../base/common/resources.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../../platform/keybinding/common/keybinding.js';\nimport { FuzzyScore, createMatches } from '../../../base/common/filters.js';\nimport { HighlightedLabel } from '../../../base/browser/ui/highlightedlabel/highlightedLabel.js';\n\nvar DataSource =\n/** @class */\nfunction () {\n  function DataSource(_resolverService) {\n    this._resolverService = _resolverService;\n  }\n\n  DataSource.prototype.hasChildren = function (element) {\n    if (element instanceof ReferencesModel) {\n      return true;\n    }\n\n    if (element instanceof FileReferences && !element.failure) {\n      return true;\n    }\n\n    return false;\n  };\n\n  DataSource.prototype.getChildren = function (element) {\n    if (element instanceof ReferencesModel) {\n      return element.groups;\n    }\n\n    if (element instanceof FileReferences) {\n      return element.resolve(this._resolverService).then(function (val) {\n        // if (element.failure) {\n        // \t// refresh the element on failure so that\n        // \t// we can update its rendering\n        // \treturn tree.refresh(element).then(() => val.children);\n        // }\n        return val.children;\n      });\n    }\n\n    throw new Error('bad tree');\n  };\n\n  DataSource = __decorate([__param(0, ITextModelService)], DataSource);\n  return DataSource;\n}();\n\nexport { DataSource }; //#endregion\n\nvar Delegate =\n/** @class */\nfunction () {\n  function Delegate() {}\n\n  Delegate.prototype.getHeight = function () {\n    return 23;\n  };\n\n  Delegate.prototype.getTemplateId = function (element) {\n    if (element instanceof FileReferences) {\n      return FileReferencesRenderer.id;\n    } else {\n      return OneReferenceRenderer.id;\n    }\n  };\n\n  return Delegate;\n}();\n\nexport { Delegate };\n\nvar StringRepresentationProvider =\n/** @class */\nfunction () {\n  function StringRepresentationProvider(_keybindingService) {\n    this._keybindingService = _keybindingService;\n  }\n\n  StringRepresentationProvider.prototype.getKeyboardNavigationLabel = function (element) {\n    if (element instanceof OneReference) {\n      var preview = element.parent.preview;\n      var parts = preview && preview.preview(element.range);\n\n      if (parts) {\n        return parts.value;\n      }\n    } // FileReferences or unresolved OneReference\n\n\n    return basename(element.uri);\n  };\n\n  StringRepresentationProvider.prototype.mightProducePrintableCharacter = function (event) {\n    return this._keybindingService.mightProducePrintableCharacter(event);\n  };\n\n  StringRepresentationProvider = __decorate([__param(0, IKeybindingService)], StringRepresentationProvider);\n  return StringRepresentationProvider;\n}();\n\nexport { StringRepresentationProvider };\n\nvar IdentityProvider =\n/** @class */\nfunction () {\n  function IdentityProvider() {}\n\n  IdentityProvider.prototype.getId = function (element) {\n    return element.id;\n  };\n\n  return IdentityProvider;\n}();\n\nexport { IdentityProvider }; //#region render: File\n\nvar FileReferencesTemplate =\n/** @class */\nfunction (_super) {\n  __extends(FileReferencesTemplate, _super);\n\n  function FileReferencesTemplate(container, _uriLabel, themeService) {\n    var _this = _super.call(this) || this;\n\n    _this._uriLabel = _uriLabel;\n    var parent = document.createElement('div');\n    dom.addClass(parent, 'reference-file');\n    _this.file = _this._register(new IconLabel(parent, {\n      supportHighlights: true\n    }));\n    _this.badge = new CountBadge(dom.append(parent, dom.$('.count')));\n\n    _this._register(attachBadgeStyler(_this.badge, themeService));\n\n    container.appendChild(parent);\n    return _this;\n  }\n\n  FileReferencesTemplate.prototype.set = function (element, matches) {\n    var parent = dirname(element.uri);\n    this.file.setLabel(getBaseLabel(element.uri), this._uriLabel.getUriLabel(parent, {\n      relative: true\n    }), {\n      title: this._uriLabel.getUriLabel(element.uri),\n      matches: matches\n    });\n    var len = element.children.length;\n    this.badge.setCount(len);\n\n    if (element.failure) {\n      this.badge.setTitleFormat(localize('referencesFailre', \"Failed to resolve file.\"));\n    } else if (len > 1) {\n      this.badge.setTitleFormat(localize('referencesCount', \"{0} references\", len));\n    } else {\n      this.badge.setTitleFormat(localize('referenceCount', \"{0} reference\", len));\n    }\n  };\n\n  FileReferencesTemplate = __decorate([__param(1, ILabelService), __param(2, IThemeService)], FileReferencesTemplate);\n  return FileReferencesTemplate;\n}(Disposable);\n\nvar FileReferencesRenderer =\n/** @class */\nfunction () {\n  function FileReferencesRenderer(_instantiationService) {\n    this._instantiationService = _instantiationService;\n    this.templateId = FileReferencesRenderer.id;\n  }\n\n  FileReferencesRenderer.prototype.renderTemplate = function (container) {\n    return this._instantiationService.createInstance(FileReferencesTemplate, container);\n  };\n\n  FileReferencesRenderer.prototype.renderElement = function (node, index, template) {\n    template.set(node.element, createMatches(node.filterData));\n  };\n\n  FileReferencesRenderer.prototype.disposeTemplate = function (templateData) {\n    templateData.dispose();\n  };\n\n  FileReferencesRenderer.id = 'FileReferencesRenderer';\n  FileReferencesRenderer = __decorate([__param(0, IInstantiationService)], FileReferencesRenderer);\n  return FileReferencesRenderer;\n}();\n\nexport { FileReferencesRenderer }; //#endregion\n//#region render: Reference\n\nvar OneReferenceTemplate =\n/** @class */\nfunction () {\n  function OneReferenceTemplate(container) {\n    this.label = new HighlightedLabel(container, false);\n  }\n\n  OneReferenceTemplate.prototype.set = function (element, score) {\n    var filePreview = element.parent.preview;\n    var preview = filePreview && filePreview.preview(element.range);\n\n    if (!preview) {\n      // this means we FAILED to resolve the document...\n      this.label.set(basename(element.uri) + \":\" + (element.range.startLineNumber + 1) + \":\" + (element.range.startColumn + 1));\n    } else {\n      // render search match as highlight unless\n      // we have score, then render the score\n      var value = preview.value,\n          highlight = preview.highlight;\n\n      if (score && !FuzzyScore.isDefault(score)) {\n        dom.toggleClass(this.label.element, 'referenceMatch', false);\n        this.label.set(value, createMatches(score));\n      } else {\n        dom.toggleClass(this.label.element, 'referenceMatch', true);\n        this.label.set(value, [highlight]);\n      }\n    }\n  };\n\n  return OneReferenceTemplate;\n}();\n\nvar OneReferenceRenderer =\n/** @class */\nfunction () {\n  function OneReferenceRenderer() {\n    this.templateId = OneReferenceRenderer.id;\n  }\n\n  OneReferenceRenderer.prototype.renderTemplate = function (container) {\n    return new OneReferenceTemplate(container);\n  };\n\n  OneReferenceRenderer.prototype.renderElement = function (node, index, templateData) {\n    templateData.set(node.element, node.filterData);\n  };\n\n  OneReferenceRenderer.prototype.disposeTemplate = function () {};\n\n  OneReferenceRenderer.id = 'OneReferenceRenderer';\n  return OneReferenceRenderer;\n}();\n\nexport { OneReferenceRenderer }; //#endregion\n\nvar AriaProvider =\n/** @class */\nfunction () {\n  function AriaProvider() {}\n\n  AriaProvider.prototype.getAriaLabel = function (element) {\n    if (element instanceof FileReferences) {\n      return element.getAriaMessage();\n    } else if (element instanceof OneReference) {\n      return element.getAriaMessage();\n    } else {\n      return null;\n    }\n  };\n\n  return AriaProvider;\n}();\n\nexport { AriaProvider };","map":null,"metadata":{},"sourceType":"module"}