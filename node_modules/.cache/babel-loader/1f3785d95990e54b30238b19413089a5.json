{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nvar __param = this && this.__param || function (paramIndex, decorator) {\n  return function (target, key) {\n    decorator(target, key, paramIndex);\n  };\n};\n\nimport './messageController.css';\nimport * as nls from '../../../nls.js';\nimport { TimeoutTimer } from '../../../base/common/async.js';\nimport { Disposable, DisposableStore, MutableDisposable } from '../../../base/common/lifecycle.js';\nimport { alert } from '../../../base/browser/ui/aria/aria.js';\nimport { Range } from '../../common/core/range.js';\nimport { registerEditorContribution, EditorCommand, registerEditorCommand } from '../../browser/editorExtensions.js';\nimport { IContextKeyService, RawContextKey } from '../../../platform/contextkey/common/contextkey.js';\nimport { registerThemingParticipant, HIGH_CONTRAST } from '../../../platform/theme/common/themeService.js';\nimport { inputValidationInfoBorder, inputValidationInfoBackground, inputValidationInfoForeground } from '../../../platform/theme/common/colorRegistry.js';\n\nvar MessageController =\n/** @class */\nfunction (_super) {\n  __extends(MessageController, _super);\n\n  function MessageController(editor, contextKeyService) {\n    var _this = _super.call(this) || this;\n\n    _this.closeTimeout = 3000; // close after 3s\n\n    _this._messageWidget = _this._register(new MutableDisposable());\n    _this._messageListeners = _this._register(new DisposableStore());\n    _this._editor = editor;\n    _this._visible = MessageController.MESSAGE_VISIBLE.bindTo(contextKeyService);\n\n    _this._register(_this._editor.onDidAttemptReadOnlyEdit(function () {\n      return _this._onDidAttemptReadOnlyEdit();\n    }));\n\n    return _this;\n  }\n\n  MessageController.get = function (editor) {\n    return editor.getContribution(MessageController._id);\n  };\n\n  MessageController.prototype.getId = function () {\n    return MessageController._id;\n  };\n\n  MessageController.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n\n    this._visible.reset();\n  };\n\n  MessageController.prototype.showMessage = function (message, position) {\n    var _this = this;\n\n    alert(message);\n\n    this._visible.set(true);\n\n    this._messageWidget.clear();\n\n    this._messageListeners.clear();\n\n    this._messageWidget.value = new MessageWidget(this._editor, position, message); // close on blur, cursor, model change, dispose\n\n    this._messageListeners.add(this._editor.onDidBlurEditorText(function () {\n      return _this.closeMessage();\n    }));\n\n    this._messageListeners.add(this._editor.onDidChangeCursorPosition(function () {\n      return _this.closeMessage();\n    }));\n\n    this._messageListeners.add(this._editor.onDidDispose(function () {\n      return _this.closeMessage();\n    }));\n\n    this._messageListeners.add(this._editor.onDidChangeModel(function () {\n      return _this.closeMessage();\n    }));\n\n    this._messageListeners.add(new TimeoutTimer(function () {\n      return _this.closeMessage();\n    }, this.closeTimeout)); // close on mouse move\n\n\n    var bounds;\n\n    this._messageListeners.add(this._editor.onMouseMove(function (e) {\n      // outside the text area\n      if (!e.target.position) {\n        return;\n      }\n\n      if (!bounds) {\n        // define bounding box around position and first mouse occurance\n        bounds = new Range(position.lineNumber - 3, 1, e.target.position.lineNumber + 3, 1);\n      } else if (!bounds.containsPosition(e.target.position)) {\n        // check if position is still in bounds\n        _this.closeMessage();\n      }\n    }));\n  };\n\n  MessageController.prototype.closeMessage = function () {\n    this._visible.reset();\n\n    this._messageListeners.clear();\n\n    if (this._messageWidget.value) {\n      this._messageListeners.add(MessageWidget.fadeOut(this._messageWidget.value));\n    }\n  };\n\n  MessageController.prototype._onDidAttemptReadOnlyEdit = function () {\n    if (this._editor.hasModel()) {\n      this.showMessage(nls.localize('editor.readonly', \"Cannot edit in read-only editor\"), this._editor.getPosition());\n    }\n  };\n\n  MessageController._id = 'editor.contrib.messageController';\n  MessageController.MESSAGE_VISIBLE = new RawContextKey('messageVisible', false);\n  MessageController = __decorate([__param(1, IContextKeyService)], MessageController);\n  return MessageController;\n}(Disposable);\n\nexport { MessageController };\nvar MessageCommand = EditorCommand.bindToContribution(MessageController.get);\nregisterEditorCommand(new MessageCommand({\n  id: 'leaveEditorMessage',\n  precondition: MessageController.MESSAGE_VISIBLE,\n  handler: function (c) {\n    return c.closeMessage();\n  },\n  kbOpts: {\n    weight: 100\n    /* EditorContrib */\n    + 30,\n    primary: 9\n    /* Escape */\n\n  }\n}));\n\nvar MessageWidget =\n/** @class */\nfunction () {\n  function MessageWidget(editor, _a, text) {\n    var lineNumber = _a.lineNumber,\n        column = _a.column; // Editor.IContentWidget.allowEditorOverflow\n\n    this.allowEditorOverflow = true;\n    this.suppressMouseDown = false;\n    this._editor = editor;\n\n    this._editor.revealLinesInCenterIfOutsideViewport(lineNumber, lineNumber, 0\n    /* Smooth */\n    );\n\n    this._position = {\n      lineNumber: lineNumber,\n      column: column - 1\n    };\n    this._domNode = document.createElement('div');\n\n    this._domNode.classList.add('monaco-editor-overlaymessage');\n\n    var message = document.createElement('div');\n    message.classList.add('message');\n    message.textContent = text;\n\n    this._domNode.appendChild(message);\n\n    var anchor = document.createElement('div');\n    anchor.classList.add('anchor');\n\n    this._domNode.appendChild(anchor);\n\n    this._editor.addContentWidget(this);\n\n    this._domNode.classList.add('fadeIn');\n  }\n\n  MessageWidget.fadeOut = function (messageWidget) {\n    var handle;\n\n    var dispose = function () {\n      messageWidget.dispose();\n      clearTimeout(handle);\n      messageWidget.getDomNode().removeEventListener('animationend', dispose);\n    };\n\n    handle = setTimeout(dispose, 110);\n    messageWidget.getDomNode().addEventListener('animationend', dispose);\n    messageWidget.getDomNode().classList.add('fadeOut');\n    return {\n      dispose: dispose\n    };\n  };\n\n  MessageWidget.prototype.dispose = function () {\n    this._editor.removeContentWidget(this);\n  };\n\n  MessageWidget.prototype.getId = function () {\n    return 'messageoverlay';\n  };\n\n  MessageWidget.prototype.getDomNode = function () {\n    return this._domNode;\n  };\n\n  MessageWidget.prototype.getPosition = function () {\n    return {\n      position: this._position,\n      preference: [1\n      /* ABOVE */\n      ]\n    };\n  };\n\n  return MessageWidget;\n}();\n\nregisterEditorContribution(MessageController);\nregisterThemingParticipant(function (theme, collector) {\n  var border = theme.getColor(inputValidationInfoBorder);\n\n  if (border) {\n    var borderWidth = theme.type === HIGH_CONTRAST ? 2 : 1;\n    collector.addRule(\".monaco-editor .monaco-editor-overlaymessage .anchor { border-top-color: \" + border + \"; }\");\n    collector.addRule(\".monaco-editor .monaco-editor-overlaymessage .message { border: \" + borderWidth + \"px solid \" + border + \"; }\");\n  }\n\n  var background = theme.getColor(inputValidationInfoBackground);\n\n  if (background) {\n    collector.addRule(\".monaco-editor .monaco-editor-overlaymessage .message { background-color: \" + background + \"; }\");\n  }\n\n  var foreground = theme.getColor(inputValidationInfoForeground);\n\n  if (foreground) {\n    collector.addRule(\".monaco-editor .monaco-editor-overlaymessage .message { color: \" + foreground + \"; }\");\n  }\n});","map":null,"metadata":{},"sourceType":"module"}