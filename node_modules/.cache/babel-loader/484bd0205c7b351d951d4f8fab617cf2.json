{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Range, SelectionRange } from '../_deps/vscode-languageserver-types/main.js';\nimport { createScanner } from '../../jsonc-parser/main.js';\nexport function getSelectionRanges(document, positions, doc) {\n  function getSelectionRange(position) {\n    var offset = document.offsetAt(position);\n    var node = doc.getNodeFromOffset(offset, true);\n    var result = [];\n\n    while (node) {\n      switch (node.type) {\n        case 'string':\n        case 'object':\n        case 'array':\n          // range without \", [ or {\n          var cStart = node.offset + 1,\n              cEnd = node.offset + node.length - 1;\n\n          if (cStart < cEnd && offset >= cStart && offset <= cEnd) {\n            result.push(newRange(cStart, cEnd));\n          }\n\n          result.push(newRange(node.offset, node.offset + node.length));\n          break;\n\n        case 'number':\n        case 'boolean':\n        case 'null':\n        case 'property':\n          result.push(newRange(node.offset, node.offset + node.length));\n          break;\n      }\n\n      if (node.type === 'property' || node.parent && node.parent.type === 'array') {\n        var afterCommaOffset = getOffsetAfterNextToken(node.offset + node.length, 5\n        /* CommaToken */\n        );\n\n        if (afterCommaOffset !== -1) {\n          result.push(newRange(node.offset, afterCommaOffset));\n        }\n      }\n\n      node = node.parent;\n    }\n\n    var current = undefined;\n\n    for (var index = result.length - 1; index >= 0; index--) {\n      current = SelectionRange.create(result[index], current);\n    }\n\n    if (!current) {\n      current = SelectionRange.create(Range.create(position, position));\n    }\n\n    return current;\n  }\n\n  function newRange(start, end) {\n    return Range.create(document.positionAt(start), document.positionAt(end));\n  }\n\n  var scanner = createScanner(document.getText(), true);\n\n  function getOffsetAfterNextToken(offset, expectedToken) {\n    scanner.setPosition(offset);\n    var token = scanner.scan();\n\n    if (token === expectedToken) {\n      return scanner.getTokenOffset() + scanner.getTokenLength();\n    }\n\n    return -1;\n  }\n\n  return positions.map(getSelectionRange);\n}","map":null,"metadata":{},"sourceType":"module"}